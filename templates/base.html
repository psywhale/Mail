{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Pioneer Alert System"/>
    <title>Cmail2 - Western Oklahoma State College</title>
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="https://www.wosc.edu/img/APPS-seal-M.ico">

    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="/static/css/blog.css" rel="stylesheet" media="screen">
    <link href="/static/css/select2.min.css" rel="stylesheet" media="screen">
    <!-- Custom styles for this template -->
    <link href="/static/css/!TEMPLATE.css" rel="stylesheet" media="screen">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <script src="/static/js/select2.full.min.js"></script>

    <![endif]-->
</head>
<body>

    <div class="user-logged-in"><i>Logged in as</i> {{ user.first_name }} {{ user.last_name }}</div>
    {% block content %}
    {% endblock %}


<footer clas="blog-footer">
    <div class="inner">
        <p>
            <div class="version" title="APPLICATION NAME: Western Course Mail System

            LEAD: &nbsp;Steve Prater
            BACK-END DEVELOPER: &nbsp; Brian Carpenter
            FRONT-END DEVELOPER: &nbsp;Nicholas Hood">
                -- <b>Course Mail System</b> -- <br>Version 0.2
            </div>
        </p>
    </div>
</footer>
<p>&nbsp;</p>

</div><!--/container-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/static/js/custom.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<!-- ### CKEditor CSS & JS ### -->
	<script src="https://cdn.ckeditor.com/4.7.3/basic/ckeditor.js"></script>
<!-- ### FOOTABLE CSS & JS ### -->
<link href="/static/css/footable.core.css" rel="stylesheet" type="text/css"/>
<link href="/static/css/footable.standalone.css" rel="stylesheet" type="text/css"/>
<script src="/static/js/footable.js" type="text/javascript"></script>
<script src="/static/js/footable.sort.js" type="text/javascript"></script>
<script src="/static/js/footable.filter.js" type="text/javascript"></script>
<script src="/static/js/image-tooltip.js" type="text/javascript"></script>
<script src="/static/js/jquery.maskedinput.min.js"></script>
<script type="text/javascript">

{#    ------- THIS IS AJAX YO --------#}
$( document ).ready(
    doAjax()
);


function doAjax() {
    getCourses();

}


function getUnreadBadges(){
    var data = {};
    var x = 1;
    $('.current-course-list').each(function(){
        data[x] = {course: this.id};
        x++;
    });

    $.ajax({
        contentType: 'application/json',
        data: JSON.stringify(data),
        dataType: 'json',
        success: function(response){
                var total = 0;
                jQuery.each(response, function(index, element){
                    if (element.count != "0") {
                        $("#" + element.course).addClass("has-badge");
                        $("#" + element.course).prepend('<div class="badge pull-right2">' + element.count + '</div>');
{#                        $("#" + element.course).attr('title', total + ' Unread messages...');#}
                        total = total + element.count;
                    }
                });
                if (total != "0") {
                    $("#inbox").prepend('<div class="badge">' + total + '</div>');
                    $("#inbox").attr('title', total + ' total un-read messages...');
                }
        },
        type: 'POST',
        url: '/listunread/'
    });
}


function getCourses(){
    $.ajax({
        url: 'https://moodle.wosc.edu/wosc/rest.php',
        data: {rest_key: 'HkHO25shu0i3Tq24iCknrB1mnpOY', action: 'get_my_courses'},
        jsonp: 'callback',
        dataType: 'jsonp',
        success: function(response) {
{#            console.log(response);#}
            jQuery.each(response, function(id, course){
{#                console.log(course.id);#}
{#                console.log(course.fullname);#}
{#                console.log(course);#}
                $('#all-courses').html($('#all-courses').html() + course.fullname);
                var termCode = calculateCurrentTermCode();
                var info = course.shortname.split("-");
                try {
                    myTC = info[1];
                    if (termCode == info[1].toLowerCase()) {
                        $('#current-courses').html($('#current-courses').html() + '<li class="current-course-list ' + course.shortname + '" id="' + course.shortname + '" title="'+ course.fullname +'"><a href="/label/' + course.shortname + '/"> ' + course.fullname + '</a></li>');
                    }
                    else {
                        $('#past-courses').html($('#past-courses').html() + '<li class="past-course-list"><a href="/label/' + course.shortname + '/"> ' + course.fullname + '</a></li>');
                    }
                    var colors = ['red','green','blue','yellow'];
                    var sectionNum = course.shortname;
                }
                catch(e){
                    return;
                }
                if ("{{ mail.section }}-{{ mail.termcode }}" == course.shortname ){
                    $('.current-course').html(course.fullname);
                }
                $('#{{ mail.section }}-{{ mail.termcode }}').addClass('active-course');

            });
            getUnreadBadges();
            addActiveCourse();
        }

    });

    return;
}


function addActiveCourse() {
var sections = window.location.pathname.split('/');
    if (sections[1] === "label"){
        console.log(sections[2]);
        $('#' + sections[2]).addClass('active-course');
    }
}


function addComposeOptionsForInstructors() {

{#    <option value="value1">Value 1</option>#}
}


function calculateCurrentTermCode(){
	var date = new Date();
	var month = date.getMonth() + 1;
	var day = date.getDate();

	if((month >= 1) && (month < 5)){
		var year = date.getYear() - 101;
        var semester = "3s";
     }
	if((month > 5) && (month < 8)){
		var year = date.getYear() - 100;
		var semester = "1s";
	}
	if((month == 5) && (day >= 20)){
		var year = date.getYear() - 100;
		var semester = "1s";
	}
	if((month >= 8) && (month <= 12)){
		var year = date.getYear() - 100;
		var semester = "2s";
	}

	return year+semester;
}


$('#archive-btn').click(function () {
    $('form#archive').submit();
});
$('#munread-btn').click(function () {
    $('form#munread').submit();
});

</script>



</body>
</html>